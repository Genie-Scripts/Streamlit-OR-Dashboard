# app.py
"""
æ‰‹è¡“ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ ãƒ¡ã‚¤ãƒ³ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³
"""

import streamlit as st
import logging
from ui.session_manager import SessionManager
from ui.page_router import PageRouter
from ui.sidebar import SidebarManager  # SidebarManagerã‚’ã‚¤ãƒ³ãƒãƒ¼ãƒˆ

# åŸºæœ¬è¨­å®š
st.set_page_config(
    page_title="æ‰‹è¡“ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰",
    page_icon="ğŸ¥",
    layout="wide",
    initial_sidebar_state="expanded"
)

# ãƒ­ã‚°è¨­å®š
logging.basicConfig(
    level=logging.INFO,
    format='%(asctime)s - %(name)s - %(levelname)s - %(message)s'
)
logger = logging.getLogger(__name__)

def main():
    """ãƒ¡ã‚¤ãƒ³ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³"""
    try:
        # ã‚»ãƒƒã‚·ãƒ§ãƒ³åˆæœŸåŒ–
        SessionManager.initialize_session_state()

        # ã‚µã‚¤ãƒ‰ãƒãƒ¼ã®æç”»ã‚’SidebarManagerã«ä¸€ä»»ã™ã‚‹
        SidebarManager.render()
        
        # ãƒ¡ã‚¤ãƒ³ã‚³ãƒ³ãƒ†ãƒ³ãƒ„è¡¨ç¤º
        router = PageRouter()
        router.render_current_page()
        
    except Exception as e:
        logger.error(f"ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³å®Ÿè¡Œã‚¨ãƒ©ãƒ¼: {e}", exc_info=True)
        st.error(f"ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ: {e}")
        if st.checkbox("ãƒ‡ãƒãƒƒã‚°æƒ…å ±ã‚’è¡¨ç¤º"):
            st.exception(e)

# ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³å®Ÿè¡Œ
if __name__ == "__main__":
    main()